{% extends 'base.html' %}

{% block content %}
    {% if user.is_authenticated %}
                <!-- Main Content -->
                <div class="col-md-10 main-content">
                    <h1>Dashboard</h1>

                    <!-- Key Metrics -->
                    <div class="row mb-4">
                        <div class="col-md-3">
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title">Total Leads</h5>
                                    <p class="card-text">{{ total_leads }}</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title">Total Clients</h5>
                                    <p class="card-text">{{ total_clients }}</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title">Open Tickets</h5>
                                    <p class="card-text">{{ open_tickets }}</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title">Closed Deals</h5>
                                    <p class="card-text">{{ closed_deals }}</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Charts and Graphs -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title">Sales Performance</h5>
                                    <canvas id="salesPerformanceChart"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title">Leads by Source</h5>
                                    <canvas id="leadsBySourceChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Activities -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title">Recent Leads Added</h5>
                                    <ul class="list-group list-group-flush">
                                        {% for lead in recent_leads %}
                                            <li class="list-group-item">{{ lead.client_name }} - {{ lead.created_at }}</li>
                                        {% empty %}
                                            <li class="list-group-item">No recent leads.</li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title">Recent Tickets</h5>
                                    <ul class="list-group list-group-flush">
                                        {% for ticket in recent_tickets %}
                                            <li class="list-group-item">{{ ticket.title }} - {{ ticket.created_at }}</li>
                                        {% empty %}
                                            <li class="list-group-item">No recent tickets.</li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Upcoming Events -->
                    <div class="row mb-4">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title">Upcoming Events</h5>
                                    <ul class="list-group list-group-flush">
                                        {% for event in upcoming_events %}
                                            <li class="list-group-item">{{ event.title }} - {{ event.date }}</li>
                                        {% empty %}
                                            <li class="list-group-item">No upcoming events.</li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

{% else %}
<!-- Display login form if the user is not authenticated -->
<div class="col-md-6 offset-md-3">
    <br>
    <h2>Login</h2>
    <br>
    <form method="POST" action="{% url 'login' %}">
        {% csrf_token %}
        <div class="form-group">
            <label for="username">Username:</label>
            <input type="text" class="form-control" id="username" name="username" required>
        </div>
        <br>
        <div class="form-group">
            <label for="password">Password:</label>
            <input type="password" class="form-control" id="password" name="password" required>
        </div>
        <br>
        <button type="submit" class="btn btn-primary">Login</button>
    </form>
</div>
{% endif %}

{% endblock %}
