{% extends 'base.html' %}

{% block content %}
<div class="container-fluid mt-5">
    <div class="card shadow-sm mx-auto" style="max-width: 1200px;">
        <div class="card-header bg-primary text-white">
            <h3 class="mb-0">Notifications</h3>
        </div>
        <div class="card-body">
            {% if notifications %}
                <ul class="list-group" id="notificationList">
                    {% for notification in notifications %}
                        <li class="list-group-item notification-item {% if not notification.is_read %}unread{% endif %}">
                            <div class="d-flex justify-content-between">
                                <div>
                                    {% if notification.link_url %}
                                        <a href="{{ notification.link_url }}" class="notification-link">{{ notification.message }}</a>
                                    {% else %}
                                        <span>{{ notification.message }}</span>
                                    {% endif %}
                                    <small class="text-muted d-block mt-1">{{ notification.created_at|date:"F d, Y, h:i A" }}</small>
                                </div>
                            </div>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <div class="alert alert-info" role="alert">
                    No notifications available.
                </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const notificationSocket = new WebSocket(
        'ws://' + window.location.host + '/ws/notifications/'
    );

    notificationSocket.onmessage = function(e) {
        const data = JSON.parse(e.data);
        const notificationsList = document.getElementById('notificationList');
        const newNotification = document.createElement('li');
        newNotification.className = 'list-group-item notification-item unread';
        newNotification.innerHTML = `
            <div class="d-flex justify-content-between">
                <div>
                    <a href="${data.link_url}" class="notification-link">
                        ${data.message}
                    </a>
                    <small class="text-muted d-block mt-1">- Just now</small>
                </div>
            </div>
        `;
        notificationsList.insertBefore(newNotification, notificationsList.firstChild);
    };

    notificationSocket.onclose = function(e) {
        console.error('Notification socket closed unexpectedly');
    };
});
</script>

<style>
/* General Styles */
.container-fluid {
    padding: 0 2rem;
}

.card {
    width: 100%;
}

.card-header {
    background-color: #007bff;
    color: white;
}

.notification-item {
    transition: background-color 0.3s ease;
}

.notification-item.unread {
    background-color: #f8d7da; /* Light red */
}

.notification-link {
    text-decoration: none;
    color: #007bff;
}

.notification-link:hover {
    text-decoration: underline;
}

.text-muted {
    font-size: 0.9rem;
}

.notification-item:hover {
    background-color: #f1f1f1;
}

/* For better alignment */
.notification-link,
.notification-item span {
    font-weight: 500;
}
</style>
{% endblock %}
